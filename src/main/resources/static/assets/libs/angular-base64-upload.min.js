!function(e,n){"use strict";e._arrayBufferToBase64=function(n){for(var t="",a=new Uint8Array(n),i=a.byteLength,r=0;r<i;r+=1)t+=String.fromCharCode(a[r]);return e.btoa(t)},e.angular.module("naif.base64",[]).directive("baseSixtyFourInput",["$window","$q",function(e,t){var a={onChange:"&",onAfterValidate:"&",parser:"&"},i=["onabort","onerror","onloadstart","onloadend","onprogress","onload"];return i.forEach(function(e){a[e]="&"}),{restrict:"A",require:"ngModel",scope:a,link:function(a,r,o,l){var f=[],s=[];function u(){var e=o.multiple?s:s[0];l.$setViewValue(e),function(e){var n=!0;if(o.maxsize&&e){var t=1e3*parseFloat(o.maxsize);if(o.multiple){for(var a=0;a<e.length;a++)if(e[a].filesize>t){n=!1;break}}else n=e.filesize<=t;l.$setValidity("maxsize",n)}}(e),function(e){var n=!0,t=1e3*parseFloat(o.minsize);if(o.minsize&&e){if(o.multiple){for(var a=0;a<e.length;a++)if(e[a].filesize<t){n=!1;break}}else n=e.filesize>=t;l.$setValidity("minsize",n)}}(e),function(e){if(o.maxnum&&o.multiple&&e){var n=e.length<=parseInt(o.maxnum);l.$setValidity("maxnum",n)}}(e),function(e){if(o.minnum&&o.multiple&&e){var n=e.length>=parseInt(o.minnum);l.$setValidity("minnum",n)}}(e),function(e){var n,t,a,i=!0;if(o.accept&&(t=o.accept.trim().replace(/[,\s]+/gi,"|").replace(/\./g,"\\.").replace(/\/\*/g,"/.*"),n=new RegExp(t)),o.accept&&e){if(o.multiple)for(var r=0;r<e.length;r++){var f=e[r];if(a="."+f.filename.split(".").pop(),!(i=n.test(f.filetype)||n.test(a)))break}else a="."+e.filename.split(".").pop(),i=n.test(e.filetype)||n.test(a);l.$setValidity("accept",i)}}(e)}function c(e,n,t,a,i){t[e]=function(e){n()(e,t,a,f,s,i)}}function p(r,l,u){for(var p=i.length-1;p>=0;p--){var d=i[p];o[d]&&"onload"!==d&&c(d,a[d],r,l,u)}var m,g,h;r.onload=(m=r,g=l,h=u,function(i){var r=i.target.result,l=o.maxsize&&g.size>1024*o.maxsize;o.doNotParseIfOversize!==n&&l?h.base64=null:h.base64=e._arrayBufferToBase64(r),(o.parser?t.when(a.parser()(g,h)):t.when(h)).then(function(e){s.push(e),g.deferredObj.resolve()}),o.onload&&(a.onload&&"function"==typeof a.onload()?a.onload()(i,m,g,f,s,h):a.onload(i,f))})}l&&(l.$isEmpty=function(e){return!e||(angular.isArray(e)?0===e.length:!e.base64)},a._clearInput=function(){r[0].value=""},a.$watch(function(){return l.$viewValue},function(e){l.$isEmpty(e)&&l.$dirty&&(a._clearInput(),l.$setValidity("maxnum",!0),l.$setValidity("minnum",!0),l.$setValidity("maxsize",!0),l.$setValidity("minsize",!0),l.$setValidity("accept",!0))}),r.on("change",function(n){var i;s=[],s=angular.copy(s),0===n.target.files.length?(f=[],u()):(f=n.target.files,function(){var n,a=[];for(n=f.length-1;n>=0;n--)f[n].deferredObj=t.defer(),a.push(f[n].deferredObj.promise);for(t.all(a).then(u),n=f.length-1;n>=0;n--){var i=new e.FileReader,r=f[n],o={};o.filetype=r.type,o.filename=r.name,o.filesize=r.size,p(i,r,o),i.readAsArrayBuffer(r)}}(),i=n,o.onChange&&(a.onChange&&"function"==typeof a.onChange()?a.onChange()(i,f):a.onChange(i,f)),function(e){if(o.onAfterValidate){for(var n=[],i=f.length-1;i>=0;i--)n.push(f[i].deferredObj.promise);t.all(n).then(function(){a.onAfterValidate&&"function"==typeof a.onAfterValidate()?a.onAfterValidate()(e,s,f):a.onAfterValidate(e,s,f)})}}(n),r[0].value=""),o.allowSameFile&&a._clearInput()}))}}}])}(window);